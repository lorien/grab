
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Task Object &#8212; Grab 0.6 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Task Queue" href="task_queue.html" />
    <link rel="prev" title="What is Grab::Spider?" href="intro.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="task-object">
<span id="spider-task"></span><h1>Task Object<a class="headerlink" href="#task-object" title="Permalink to this headline">¶</a></h1>
<p>Any Grab::Spider crawler is a set of handlers that process network responses.
Each handler can spawn new network requests or just process/save data.
The spider add each new request to task queue and process this task when there
is free network stream. Each task is assigned a name that defines its type.
Each type of task are handles by specific handler. To find the handler the
Spider takes name of the task and then looks for <cite>task_&lt;name&gt;</cite> method.</p>
<p>For example, to handle result of task named “contact_page” we need to define
“task_contact_page” method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="o">...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="s1">&#39;contact_page&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://domain.com/contact.html&#39;</span><span class="p">))</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">task_contact_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grab</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<section id="constructor-of-task-class">
<h2>Constructor of Task Class<a class="headerlink" href="#constructor-of-task-class" title="Permalink to this headline">¶</a></h2>
<p>Constructor of Task Class accepts multiple arguments. At least you have to
specify URL of requested document OR the configured Grab object. Next, you
see examples of different task creation. All three examples do the same:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using `url` argument</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;wikipedia&#39;</span><span class="p">,</span> <span class="n">url</span> <span class="s1">&#39;http://wikipedia.org/&#39;</span><span class="p">)</span>

<span class="c1"># Using Grab intance</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Grab</span><span class="p">()</span>
<span class="n">g</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://wikipedia.org/&#39;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;wikipedia&#39;</span><span class="p">,</span> <span class="n">grab</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>

<span class="c1"># Using configured state of Grab instance</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Grab</span><span class="p">()</span>
<span class="n">g</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://wikipedia.org/&#39;</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">dump_config</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;wikipedia&#39;</span><span class="p">,</span> <span class="n">grab_config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
<p>Also you can specify these arguments:</p>
<dl class="field-list simple">
<dt class="field-odd">priority</dt>
<dd class="field-odd"><p>task priority, it’s unsigned natural number, the less number mean the higher priority.</p>
</dd>
<dt class="field-even">disable_cache</dt>
<dd class="field-even"><p>don’t use spider’s cache for this request, network response will not stored into cache as well.</p>
</dd>
<dt class="field-odd">refresh_cache</dt>
<dd class="field-odd"><p>do not use spider’s cache, in case of success response it will refresh cache.</p>
</dd>
<dt class="field-even">valid_status</dt>
<dd class="field-even"><p>procces the following response codes in task handler. By default only 2xx and 404 statuses will be processed in task handlers.</p>
</dd>
<dt class="field-odd">use_proxylist</dt>
<dd class="field-odd"><p>use spider’s global proxy list, by default this oprion is True</p>
</dd>
</dl>
</section>
<section id="task-object-as-data-storage">
<h2>Task Object as Data Storage<a class="headerlink" href="#task-object-as-data-storage" title="Permalink to this headline">¶</a></h2>
<p>If you pass the argument that is unknown then it will be saved in the Task
object. That allows you to pass data between network request/response.</p>
<p>There is <cite>get</cite> method that return value of task attribute or <cite>None</cite> if that
attribute have not been defined.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;bing&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://bing.com/&#39;</span><span class="p">,</span> <span class="n">disable_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">foo</span> <span class="c1"># == &quot;bar&quot;</span>
<span class="n">t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="c1"># == &quot;bar&quot;</span>
<span class="n">t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;asdf&#39;</span><span class="p">)</span> <span class="c1"># == None</span>
<span class="n">t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;asdf&#39;</span><span class="p">,</span> <span class="s1">&#39;qwerty&#39;</span><span class="p">)</span> <span class="c1"># == &quot;qwerty&quot;</span>
</pre></div>
</div>
</section>
<section id="cloning-task-object">
<h2>Cloning Task Object<a class="headerlink" href="#cloning-task-object" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it is useful to create copy of Task object. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># task.clone()</span>
<span class="c1"># TODO: example</span>
</pre></div>
</div>
</section>
<section id="setting-up-initial-tasks">
<h2>Setting Up Initial Tasks<a class="headerlink" href="#setting-up-initial-tasks" title="Permalink to this headline">¶</a></h2>
<p>When you call <cite>run</cite> method of your spider it starts working from initial tasks.
There are few ways to setup initial tasks.</p>
<section id="initial-urls">
<span id="spider-task-initial-urls"></span><h3>initial_urls<a class="headerlink" href="#initial-urls" title="Permalink to this headline">¶</a></h3>
<p>You can specify list of URLs in <cite>self.initial_urls</cite>. For each URl in this list
the spider will create Task object with name “initial”:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleSpider</span><span class="p">(</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">initial_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http://google.com/&#39;</span><span class="p">,</span> <span class="s1">&#39;http://yahoo.com/&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="task-generator">
<span id="spider-task-generator"></span><h3>task_generator<a class="headerlink" href="#task-generator" title="Permalink to this headline">¶</a></h3>
<p>More flexible way to define initial tasks is to use <cite>task_generator</cite> method.
Its interface is simple, you just have to yield new Task objects.</p>
<p>There is common use case when you need to process big number of URLs from the
file. With <cite>task_generator</cite> you can iterate over lines of the file and yield
new tasks. That will save memory used by the script because you will not read
whole file into the memory. Spider consumes only portion of tasks from
<cite>task_generator</cite>. When there are free networks resources the spiders consumes
next portion of task. And so on.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleSpider</span><span class="p">(</span><span class="n">Spider</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">task_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;var/urls.txt&#39;</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;download&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>
</div>
</section>
</section>
<section id="explicit-ways-to-add-new-task">
<h2>Explicit Ways to Add New Task<a class="headerlink" href="#explicit-ways-to-add-new-task" title="Permalink to this headline">¶</a></h2>
<section id="adding-tasks-with-add-task-method">
<h3>Adding Tasks With add_task method<a class="headerlink" href="#adding-tasks-with-add-task-method" title="Permalink to this headline">¶</a></h3>
<p>You can use <cite>add_task</cite> method anywhere, even before the spider have started working:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bot</span> <span class="o">=</span> <span class="n">ExampleSpider</span><span class="p">()</span>
<span class="n">bot</span><span class="o">.</span><span class="n">setup_queue</span><span class="p">()</span>
<span class="n">bot</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s1">&#39;google&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://google.com&#39;</span><span class="p">)</span>
<span class="n">bot</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="yield-new-tasks">
<h3>Yield New Tasks<a class="headerlink" href="#yield-new-tasks" title="Permalink to this headline">¶</a></h3>
<p>You can use yield statement to add new tasks in two places. First, in
<a class="reference internal" href="#spider-task-generator"><span class="std std-ref">task_generator</span></a>. Second, in any handler. Using yield is
completely equal to using <cite>add_task</cite> method. The yielding is just a bit
more beautiful:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleSpider</span><span class="p">(</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">initial_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http://google.com&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">task_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grab</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="c1"># Google page was fetched</span>
        <span class="c1"># Now let&#39;s download yahoo page</span>
        <span class="k">yield</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;yahoo&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;yahoo.com&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">task_yahoo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grab</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</section>
</section>
<section id="default-grab-instance">
<span id="spider-default-grab-instance"></span><h2>Default Grab Instance<a class="headerlink" href="#default-grab-instance" title="Permalink to this headline">¶</a></h2>
<p>You can control the default config of Grab instances used in spider tasks.
Define the <cite>create_grab_instance</cite> method in your spider class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestSpider</span><span class="p">(</span><span class="n">Spider</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_grab_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">TestSpider</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create_grab_instance</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g</span>
</pre></div>
</div>
<p>Be aware, that this method allows you to control only those Grab instances
that were created automatically. If you create task with explicit grab instance
it will not be affected by <cite>create_grab_instance_method</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestSpider</span><span class="p">(</span><span class="n">Spider</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_grab_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Grab</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g</span>

    <span class="k">def</span> <span class="nf">task_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Grab</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="n">grab</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
        <span class="c1"># The grab instance in the yielded task</span>
        <span class="c1"># will not be affected by `create_grab_instance` method.</span>
</pre></div>
</div>
</section>
<section id="updating-any-grab-instance">
<span id="spider-updating-any-grab-instance"></span><h2>Updating Any Grab Instance<a class="headerlink" href="#updating-any-grab-instance" title="Permalink to this headline">¶</a></h2>
<p>With method <cite>update_grab_instance</cite> you can update any Grab instance, even those
instances that you have passed explicitly to the Task object. Be aware, that
any option configured in this method overwrites the previously configured
option.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestSpider</span><span class="p">(</span><span class="n">Spider</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">update_grab_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grab</span><span class="p">):</span>
        <span class="n">grab</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">task_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Grab</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">Task</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="n">grab</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
        <span class="c1"># The effective timeout setting will be equal to 20!</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Grab</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/installation.html">Grab Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/testing.html">Testing Grab Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/quickstart.html">Grab Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/request_method.html">Request Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/request_setup.html">Setting up the Grab Request</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/settings.html">Grab Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/request_headers.html">Work with HTTP Headers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/response_body.html">Processing the Response Body</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/file_uploading.html">File Uploading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/redirect.html">Redirect Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/forms.html">Form Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/network_errors.html">Network Errors Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/charset.html">HTML Document Charset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/cookies.html">Cookie Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/proxy.html">Proxy Server Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/response_search.html">Searching the response body</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/response.html">Work With Network Response</a></li>
<li class="toctree-l1"><a class="reference internal" href="../grab/transport.html">Network Transport</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">What is Grab::Spider?</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Task Object</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#constructor-of-task-class">Constructor of Task Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#task-object-as-data-storage">Task Object as Data Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloning-task-object">Cloning Task Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-initial-tasks">Setting Up Initial Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#explicit-ways-to-add-new-task">Explicit Ways to Add New Task</a></li>
<li class="toctree-l2"><a class="reference internal" href="#default-grab-instance">Default Grab Instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-any-grab-instance">Updating Any Grab Instance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="task_queue.html">Task Queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="cache.html">Spider Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_handling.html">Spider Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="transport.html">Explanation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/grab_base.html">Module grab.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/grab_error.html">Module grab.error</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/grab_cookie.html">Module grab.cookie</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/grab_spider_base.html">Module grab.spider</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/grab_document.html">Module grab.document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/grab_spider_task.html">Module grab.spider.task</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="intro.html" title="previous chapter">What is Grab::Spider?</a></li>
      <li>Next: <a href="task_queue.html" title="next chapter">Task Queue</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015 – 2022, Gregory Petukhov.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/spider/task.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>